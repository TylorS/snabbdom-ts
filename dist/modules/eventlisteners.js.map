{"version":3,"file":null,"sources":["../../src/is.ts","../../src/modules/eventlisteners.ts"],"sourcesContent":["const is = {\n  array: Array.isArray,\n  primitive(x: any) {\n    return typeof x === 'string' || typeof x === 'number'\n  }\n}\n\nexport default is\n","import { VNode, Module } from '../interfaces'\nimport is from '../is'\n\nfunction arrInvoker(arr: any[]) {\n  return function() {\n    if (!arr.length) return\n    // Special case when length is two, for performance\n    arr.length === 2 ? arr[0](arr[1]) : arr[0].apply(undefined, arr.slice(1))\n  }\n}\n\nfunction fnInvoker(o: { fn: (event: Event) => any }) {\n  return function(ev: Event) {\n    if (o.fn === null) return\n    o.fn(ev)\n  }\n}\n\nfunction updateEventListeners (oldVnode: VNode, vnode: VNode) {\n  let name: any\n  let cur: any\n  let old: any\n  let elm = vnode.elm as HTMLElement\n  let oldOn = oldVnode.data && oldVnode.data.on\n  let on = vnode.data && vnode.data.on\n\n  if (!on && !oldOn) return\n  on = on || {}\n  oldOn = oldOn || {}\n\n  for (name in on) {\n    cur = on[name]\n    old = oldOn[name]\n    if (old === undefined) {\n      if (is.array(cur)) {\n        elm.addEventListener(name, arrInvoker(cur))\n      } else {\n        cur = {fn: cur}\n        on[name] = cur\n        elm.addEventListener(name, fnInvoker(cur))\n      }\n    } else if (is.array(old)) {\n      // Deliberately modify old array since it's captured in closure created with `arrInvoker`\n      old.length = cur.length\n      for (let i = 0; i < old.length; ++i) old[i] = cur[i]\n      on[name]  = old\n    } else {\n      old.fn = cur\n      on[name] = old\n    }\n  }\n  if (oldOn) {\n    for (name in oldOn) {\n      if (on[name] === undefined) {\n        old = oldOn[name]\n        if (is.array(old)) {\n          old.length = 0\n        } else {\n          old.fn = null\n        }\n      }\n    }\n  }\n}\n\nexport const EventListenerModule: Module = {\n  create: updateEventListeners,\n  update: updateEventListeners\n}\n"],"names":[],"mappings":"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"}