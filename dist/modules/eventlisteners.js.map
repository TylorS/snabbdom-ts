{"version":3,"file":null,"sources":["../../src/is.ts","../../src/modules/eventlisteners.ts"],"sourcesContent":["const is = {\n  array: Array.isArray,\n  primitive(x: any) {\n    return typeof x === 'string' || typeof x === 'number'\n  }\n}\n\nexport default is\n","import { VNode, Module } from '../interfaces'\nimport is from '../is'\n\nfunction arrInvoker(arr: any[]) {\n  return function() {\n    if (!arr.length) return\n    // Special case when length is two, for performance\n    arr.length === 2 ? arr[0](arr[1]) : arr[0].apply(undefined, arr.slice(1))\n  }\n}\n\nfunction fnInvoker(o: { fn: (event: Event) => any }) {\n  return function(ev: Event) {\n    if (o.fn === null) return\n    o.fn(ev)\n  }\n}\n\nfunction updateEventListeners (oldVnode: VNode, vnode: VNode) {\n  let name: any\n  let cur: any\n  let old: any\n  let elm = vnode.elm as HTMLElement\n  let oldOn = oldVnode.data && oldVnode.data.on\n  let on = vnode.data && vnode.data.on\n\n  if (!on && !oldOn) return\n  on = on || {}\n  oldOn = oldOn || {}\n\n  for (name in on) {\n    cur = on[name]\n    old = oldOn[name]\n    if (old === undefined) {\n      if (is.array(cur)) {\n        elm.addEventListener(name, arrInvoker(cur))\n      } else {\n        cur = {fn: cur}\n        on[name] = cur\n        elm.addEventListener(name, fnInvoker(cur))\n      }\n    } else if (is.array(old)) {\n      // Deliberately modify old array since it's captured in closure created with `arrInvoker`\n      old.length = cur.length\n      for (let i = 0; i < old.length; ++i) old[i] = cur[i]\n      on[name]  = old\n    } else {\n      old.fn = cur\n      on[name] = old\n    }\n  }\n  if (oldOn) {\n    for (name in oldOn) {\n      if (on[name] === undefined) {\n        old = oldOn[name]\n        if (is.array(old)) {\n          old.length = 0\n        } else {\n          old.fn = null\n        }\n      }\n    }\n  }\n}\n\nconst EventListenerModule: Module = {\n  create: updateEventListeners,\n  update: updateEventListeners\n}\n\nexport default EventListenerModule\n"],"names":[],"mappings":"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"}