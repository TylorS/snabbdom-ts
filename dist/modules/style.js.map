{"version":3,"file":null,"sources":["../../src/modules/style.ts"],"sourcesContent":["import { VNode, Module} from '../interfaces'\n\nconst raf = (typeof window !== 'undefined' && window.requestAnimationFrame) || setTimeout\nconst nextFrame = function nextFrame(fn: any) { raf(function() { raf(fn) }) }\n\nfunction setNextFrame(obj: any, prop: string, val: any) {\n  nextFrame(function() { obj[prop] = val })\n}\n\nfunction updateStyle(oldVnode: VNode, vnode: VNode) {\n  if (!vnode.data && !oldVnode.data) return\n  let cur: any\n  let name: any\n  let elm = vnode.elm as HTMLElement\n  let oldStyle = oldVnode.data && oldVnode.data.style || {}\n  let style = vnode.data && vnode.data.style || {}\n  let oldHasDel = 'delayed' in oldStyle\n\n  for (name in oldStyle) {\n    if (!style[name]) {\n      (<HTMLElement> elm).style[name] = ''\n    }\n  }\n  for (name in style) {\n    cur = style[name]\n    if (name === 'delayed') {\n      for (name in (<any> style).delayed) {\n        cur = (<any> style).delayed[name]\n        if (!oldHasDel || cur !== (<any> oldStyle).delayed[name]) {\n          setNextFrame((<HTMLElement> elm).style, name, cur)\n        }\n      }\n    } else if (name !== 'remove' && cur !== oldStyle[name]) {\n      (<HTMLElement> elm).style[name] = cur\n    }\n  }\n}\n\nfunction applyDestroyStyle(vnode: VNode) {\n  let style: any\n  let name: any\n  let elm = vnode.elm\n  let s = vnode.data && vnode.data.style\n\n  if (!s || !(style = (<any> s).destroy)) return\n  for (name in style) {\n    (<HTMLElement> elm).style[name] = style[name]\n  }\n}\n\nfunction applyRemoveStyle(vnode: VNode, rm: () => void) {\n  let s = vnode && vnode.data && vnode.data.style\n  if (!s || !(<any> s).remove) {\n    rm()\n    return\n  }\n  let name: any\n  let elm = vnode.elm\n  if (!elm) return\n  let i = 0\n  let compStyle: any\n  let style = (<any> s).remove\n  let amount = 0\n  let applied: any[] = []\n  for (name in style) {\n    applied.push(name);\n    (<HTMLElement> elm).style[name] = style[name]\n  }\n  compStyle = getComputedStyle((<HTMLElement> elm))\n  let props = compStyle['transition-property'].split(', ')\n  for (; i < props.length; ++i) {\n    if (applied.indexOf(props[i]) !== -1) amount++\n  }\n  elm.addEventListener('transitionend', function(ev) {\n    if (ev.target === elm) --amount\n    if (amount === 0) rm()\n  })\n}\n\nconst StyleModule: Module = {\n  create: updateStyle,\n  update: updateStyle,\n  destroy: applyDestroyStyle,\n  remove: applyRemoveStyle\n}\n\nexport default StyleModule\n"],"names":[],"mappings":"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"}