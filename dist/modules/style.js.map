{"version":3,"file":null,"sources":["../../src/modules/style.ts"],"sourcesContent":["import { VNode, Module} from '../interfaces'\n\nconst raf = (typeof window !== 'undefined' && window.requestAnimationFrame) || setTimeout\nconst nextFrame = function nextFrame(fn: any) { raf(function() { raf(fn) }) }\n\nfunction setNextFrame(obj: any, prop: string, val: any) {\n  nextFrame(function() { obj[prop] = val })\n}\n\nfunction updateStyle(oldVnode: VNode, vnode: VNode) {\n  if (!vnode.data && !oldVnode.data) return\n  let cur: any\n  let name: any\n  let elm = vnode.elm as HTMLElement\n  let oldStyle = oldVnode.data && oldVnode.data.style || {}\n  let style = vnode.data && vnode.data.style || {}\n  let oldHasDel = 'delayed' in oldStyle\n\n  for (name in oldStyle) {\n    if (!style[name]) {\n      (<HTMLElement> elm).style[name] = ''\n    }\n  }\n  for (name in style) {\n    cur = style[name]\n    if (name === 'delayed') {\n      for (name in (<any> style).delayed) {\n        cur = (<any> style).delayed[name]\n        if (!oldHasDel || cur !== (<any> oldStyle).delayed[name]) {\n          setNextFrame((<HTMLElement> elm).style, name, cur)\n        }\n      }\n    } else if (name !== 'remove' && cur !== oldStyle[name]) {\n      (<HTMLElement> elm).style[name] = cur\n    }\n  }\n}\n\nfunction applyDestroyStyle(vnode: VNode) {\n  let style: any\n  let name: any\n  let elm = vnode.elm\n  let s = vnode.data && vnode.data.style\n\n  if (!s || !(style = (<any> s).destroy)) return\n  for (name in style) {\n    (<HTMLElement> elm).style[name] = style[name]\n  }\n}\n\nfunction applyRemoveStyle(vnode: VNode, rm: () => void) {\n  let s = vnode && vnode.data && vnode.data.style\n  if (!s || !(<any> s).remove) {\n    rm()\n    return\n  }\n  let name: any\n  let elm = vnode.elm\n  if (!elm) return\n  let i = 0\n  let compStyle: any\n  let style = (<any> s).remove\n  let amount = 0\n  let applied: any[] = []\n  for (name in style) {\n    applied.push(name);\n    (<HTMLElement> elm).style[name] = style[name]\n  }\n  compStyle = getComputedStyle((<HTMLElement> elm))\n  let props = compStyle['transition-property'].split(', ')\n  for (; i < props.length; ++i) {\n    if (applied.indexOf(props[i]) !== -1) amount++\n  }\n  elm.addEventListener('transitionend', function(ev) {\n    if (ev.target === elm) --amount\n    if (amount === 0) rm()\n  })\n}\n\nconst StyleModule: Module = {\n  create: updateStyle,\n  update: updateStyle,\n  destroy: applyDestroyStyle,\n  remove: applyRemoveStyle\n}\n\nexport default StyleModule\n"],"names":[],"mappings":"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"}